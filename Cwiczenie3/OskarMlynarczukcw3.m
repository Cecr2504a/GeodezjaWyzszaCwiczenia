clear
clc
format longg
X=3763917.000
Y=1235727.000
Z=4982084.000+33*15
A=6378137.000;
e2=0.00669438002290;
WspKart=[X,Y,Z]
hirvonen(X,Y,Z)
sAB=35125.123;
azAB=(70*pi/180)+33*pi/180;
zAB=(85*pi/180)+33*pi/(180*60);
F=WspGeo(1)*pi/180
La=WspGeo(2)*pi/180
a=6378137.000;
e2=0.00669438002290;
n=sAB/125;
ds=sAB/n;
for i=1:n
    M=a*(1-e2)/sqrt((1-e2*(sin(F))^2)^3);
    N=a/sqrt(1-e2*(sin(F))^2);
    dfi=(ds*cos(azAB))/M;
    dAab=(sin(azAB)*tan(F)*ds)/N;
    fim=F+0.5*dfi;
    Aabm=azAB+0.5*dAab;
    Mm=a*(1-e2)/sqrt((1-e2*(sin(fim))^2)^3);
    Nm=a/sqrt(1-e2*(sin(fim))^2);
    dfim=(cos(Aabm)*ds)/Mm;
    dlamb=(sin(Aabm)*ds)/(Nm*cos(fim));
    dAm=(sin(Aabm)*tan(fim)*ds)/Nm;
    F=F+dfim;
    La=La+dlamb;
    azAB=azAB+dAm;
end
Fb=F;
Lab=La;
azBA=azAB+pi;
fist=Fb*180/pi
lambst=Lab*180/pi
azABst=azAB*180/pi
azBAst=azBA*180/pi
zmn=[fist,lambst,azABst,azBAst]
KatStop(zmn)
